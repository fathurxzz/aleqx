@using Shop.Helpers
@model Shop.Models.ShopViewModel

@{
    
    Layout = "~/Views/Shared/_Layout.cshtml";
}

@section Categories
{
    @Html.Partial("_Categories",Model.Categories)
}

@section Brands
{
    @Html.Partial("_Brands",Model.Brands)
}

@section Tags
{
    @Html.Partial("_Tags",Model.Tags)
}

<div class="product">
    <div class="title">@Model.Product.Title</div>
    <div class="images">
    
    @{
        
        var mainImage = Model.Product.ProductImages.FirstOrDefault(im => im.Default) ?? Model.Product.ProductImages.FirstOrDefault();
        if (mainImage != null)
        {
            <div class="image">
            <a rel="@Html.Raw("group" + Model.Product.Id)" href="../../../Content/Images/@mainImage.ImageSource" class="fancy">
            @Html.Raw(Html.CachedImage("~/Content/Images/", mainImage.ImageSource, "thumbnail2", mainImage.ImageSource))
            </a>
            </div>
        }


        foreach (var image in Model.Product.ProductImages.Where(im=>!im.Default))
        {
            <a rel="@Html.Raw("group" + Model.Product.Id)" href="../../../Content/Images/@image.ImageSource" class="fancy">
            @Html.Raw(Html.CachedImage("~/Content/Images/", image.ImageSource, "thumbnail0", image.ImageSource))
            </a>
        }

    }
    

    <div class="clear"></div>
    </div>
    <div class="description">@Model.Product.Description</div>
    <div class="attributes">
    <table>
    @foreach (var attribute in Model.Product.Category.ProductAttributes)
    {
        <tr>
            <td class="attrTitle">@Html.Raw(attribute.Name + (!string.IsNullOrEmpty(attribute.ValueType) ? (", " + attribute.ValueType + ":") : ""))</td>
            <td>
            
            @foreach (var attributeValue in Model.Product.ProductAttributeValues)
            {
                if (attribute.ProductAttributeValues.Contains(attributeValue))
                {
                    @Html.Raw(attributeValue.Value + "; ")
                }

            }
            
            </td>
        </tr>
    }
    </table>
    </div>
    <div class="price">
        @Model.Product.Price.ToString("N") грн.
    </div>
    <div class="buttons">
            <a href="#" class="addToCart" onclick="Shop.addToCart(@Model.Product.Id)">В корзину</a>
        </div>
</div>

@section Includes
    {
<link href="@Url.Content("~/Content/fancybox/jquery.fancybox-1.3.4.css")" rel="stylesheet" type="text/css" />
<script src="@Url.Content("~/Content/fancybox/jquery.fancybox-1.3.4.js")" type="text/javascript"></script>
<script type="text/javascript">
    $(function () {
        $(".fancy").fancybox({ titlePosition: 'inside', showCloseButton: true, cyclic: false, showNavArrows: true, padding: 0, margin: 0, centerOnScroll: true });
    });
</script>
}
