
-- --------------------------------------------------
-- Entity Designer DDL Script for SQL Server Compact Edition
-- --------------------------------------------------
-- Date Created: 01/13/2014 12:14:09
-- Generated from EDMX file: D:\projects\iBank\iBank.TestData\Model1.edmx
-- --------------------------------------------------


-- --------------------------------------------------
-- Dropping existing FOREIGN KEY constraints
-- NOTE: if the constraint does not exist, an ignorable error will be reported.
-- --------------------------------------------------

    ALTER TABLE [Token] DROP CONSTRAINT [FK_TokenTypeToken];
GO
    ALTER TABLE [Token] DROP CONSTRAINT [FK_UserToken];
GO
    ALTER TABLE [OtpSms] DROP CONSTRAINT [FK_TokenOtpSms];
GO
    ALTER TABLE [Token] DROP CONSTRAINT [FK_SessionToken];
GO

-- --------------------------------------------------
-- Dropping existing tables
-- NOTE: if the table does not exist, an ignorable error will be reported.
-- --------------------------------------------------

    DROP TABLE [Token];
GO
    DROP TABLE [TokenType];
GO
    DROP TABLE [User];
GO
    DROP TABLE [OtpSms];
GO
    DROP TABLE [Session];
GO

-- --------------------------------------------------
-- Creating all tables
-- --------------------------------------------------

-- Creating table 'Token'
CREATE TABLE [Token] (
    [Id] int IDENTITY(1,1) NOT NULL,
    [ExpireDate] datetime  NOT NULL,
    [Ip] nchar(15)  NOT NULL,
    [IsActive] bit  NOT NULL,
    [Content] nchar(200)  NOT NULL,
    [TokenTypeId] int  NOT NULL,
    [UserId] int  NOT NULL,
    [SessionId] int  NOT NULL
);
GO

-- Creating table 'TokenType'
CREATE TABLE [TokenType] (
    [Id] int IDENTITY(1,1) NOT NULL,
    [Name] nchar(50)  NOT NULL
);
GO

-- Creating table 'User'
CREATE TABLE [User] (
    [Id] int IDENTITY(1,1) NOT NULL,
    [IsActive] bit  NOT NULL,
    [Login] nchar(50)  NOT NULL,
    [Password] nchar(50)  NOT NULL,
    [Name] nchar(50)  NOT NULL,
    [PasswordExpireDate] datetime  NOT NULL
);
GO

-- Creating table 'OtpSms'
CREATE TABLE [OtpSms] (
    [Id] int IDENTITY(1,1) NOT NULL,
    [Content] nchar(200)  NOT NULL,
    [Password] nchar(50)  NOT NULL,
    [ExpireDate] datetime  NOT NULL,
    [TokenId] int  NOT NULL
);
GO

-- Creating table 'Session'
CREATE TABLE [Session] (
    [Id] int IDENTITY(1,1) NOT NULL,
    [ExpireDate] nvarchar(4000)  NOT NULL,
    [Status] nvarchar(4000)  NOT NULL
);
GO

-- --------------------------------------------------
-- Creating all PRIMARY KEY constraints
-- --------------------------------------------------

-- Creating primary key on [Id] in table 'Token'
ALTER TABLE [Token]
ADD CONSTRAINT [PK_Token]
    PRIMARY KEY ([Id] );
GO

-- Creating primary key on [Id] in table 'TokenType'
ALTER TABLE [TokenType]
ADD CONSTRAINT [PK_TokenType]
    PRIMARY KEY ([Id] );
GO

-- Creating primary key on [Id] in table 'User'
ALTER TABLE [User]
ADD CONSTRAINT [PK_User]
    PRIMARY KEY ([Id] );
GO

-- Creating primary key on [Id] in table 'OtpSms'
ALTER TABLE [OtpSms]
ADD CONSTRAINT [PK_OtpSms]
    PRIMARY KEY ([Id] );
GO

-- Creating primary key on [Id] in table 'Session'
ALTER TABLE [Session]
ADD CONSTRAINT [PK_Session]
    PRIMARY KEY ([Id] );
GO

-- --------------------------------------------------
-- Creating all FOREIGN KEY constraints
-- --------------------------------------------------

-- Creating foreign key on [TokenTypeId] in table 'Token'
ALTER TABLE [Token]
ADD CONSTRAINT [FK_TokenTypeToken]
    FOREIGN KEY ([TokenTypeId])
    REFERENCES [TokenType]
        ([Id])
    ON DELETE NO ACTION ON UPDATE NO ACTION;

-- Creating non-clustered index for FOREIGN KEY 'FK_TokenTypeToken'
CREATE INDEX [IX_FK_TokenTypeToken]
ON [Token]
    ([TokenTypeId]);
GO

-- Creating foreign key on [UserId] in table 'Token'
ALTER TABLE [Token]
ADD CONSTRAINT [FK_UserToken]
    FOREIGN KEY ([UserId])
    REFERENCES [User]
        ([Id])
    ON DELETE NO ACTION ON UPDATE NO ACTION;

-- Creating non-clustered index for FOREIGN KEY 'FK_UserToken'
CREATE INDEX [IX_FK_UserToken]
ON [Token]
    ([UserId]);
GO

-- Creating foreign key on [TokenId] in table 'OtpSms'
ALTER TABLE [OtpSms]
ADD CONSTRAINT [FK_TokenOtpSms]
    FOREIGN KEY ([TokenId])
    REFERENCES [Token]
        ([Id])
    ON DELETE NO ACTION ON UPDATE NO ACTION;

-- Creating non-clustered index for FOREIGN KEY 'FK_TokenOtpSms'
CREATE INDEX [IX_FK_TokenOtpSms]
ON [OtpSms]
    ([TokenId]);
GO

-- Creating foreign key on [SessionId] in table 'Token'
ALTER TABLE [Token]
ADD CONSTRAINT [FK_SessionToken]
    FOREIGN KEY ([SessionId])
    REFERENCES [Session]
        ([Id])
    ON DELETE NO ACTION ON UPDATE NO ACTION;

-- Creating non-clustered index for FOREIGN KEY 'FK_SessionToken'
CREATE INDEX [IX_FK_SessionToken]
ON [Token]
    ([SessionId]);
GO

-- --------------------------------------------------
-- Script has ended
-- --------------------------------------------------