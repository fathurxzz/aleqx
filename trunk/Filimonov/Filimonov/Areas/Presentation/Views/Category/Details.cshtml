@using Filimonov
@using Filimonov.Models
@using SiteExtensions.Graphics
@model Filimonov.Models.Category
@{
    ViewBag.Title = "Библиотека изображений - " + Model.Title;
    Layout = "~/Areas/Presentation/Views/Shared/_Layout.cshtml";
}
@if (Roles.IsUserInRole(User.Identity.Name, "Administrators"))
{
    <div>
        @Html.ActionLink("Добавить изображения", "Create", "Product", new { area = "Presentation", id = Model.Id }, new { @class = "adminLink" })
    </div>
}
@Html.Partial("_PresentationMenu")
<div class="category-title">
    <h1>@Model.Title</h1>
</div>
<div class="layouts-filter">
    @{
        var layouts = (IEnumerable<Layout>)ViewBag.Layouts;
    }
    <ul>
        @foreach (var item in layouts)
        {
            if (ViewBag.Layout == item.Name || (string.IsNullOrEmpty(item.Name) && string.IsNullOrEmpty(ViewBag.Layout)))
            {
            <li>@item.Title</li>
            }
            else
            {
            <li>@Html.ActionLink(item.Title, "Details", "Category", new { id = Model.Name, layout = item.Name }, null)</li>
            }

        }
    </ul>
</div>
@using (Html.BeginForm("AddProductToSet", "UserCabinet", FormMethod.Post))
{

    @Html.Hidden("categoryId", Model.Name)
    @Html.Hidden("enablities")
    
    <div class="category-details">
        @foreach (var item in Model.Products)
        {
            if (item.Layout.Name == ViewBag.Layout || string.IsNullOrEmpty(ViewBag.Layout))
            {
                var id = "p_" + item.Id;

            <div class="product" id="@id">
                <div class="selectedMarker">
                </div>
                @if (Roles.IsUserInRole(User.Identity.Name, "Administrators"))
                {
                    <div class="abs">
                        @Html.ActionLink("Сделать обложкой", "MakeDefaultPicture", "Product", new { area = "Presentation", id = item.Id }, new { @class = "adminLink", onclick = "return confirm('Сделать обложкой?')" })
                        @Html.ActionLink("Удалить", "Delete", "Product", new { area = "Presentation", id = item.Id }, new { @class = "adminLink", onclick = "return confirm('Удалить изображение?')" })
                    </div>
                }
                @Html.Raw(Html.CachedImage("~/Content/Images/", item.ImageSource, SiteSettings.GetThumbnail("categoryProduct")))
            </div>
            }
        }
        <div class="clear">
        </div>
    </div>

        if (!Roles.IsUserInRole(User.Identity.Name, "Administrators"))
        {
            <div class="addToProductSetPanel">
                Куда копировать выбранные изображения?
                @{
                    var sl = new List<SelectListItem>();
                    sl.AddRange(((IEnumerable<ProductSet>)ViewBag.ProductSets).Select(pc => new SelectListItem { Text = pc.Title, Value = pc.Id.ToString() }).OrderBy(pc=>pc.Value) .ToList());
                    @Html.DropDownList("productContainers", sl)
                }
                <input type="submit" value="Скопировать" onclick=" return PresentationPageExtender.collectChanges() " />
            </div>
        }

}