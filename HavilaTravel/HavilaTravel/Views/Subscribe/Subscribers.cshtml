@using Dev.Mvc.Helpers
@using HavilaTravel.Models
@model SiteViewModel
@{
    ViewBag.Title = "Subscribers";
    Layout = "~/Views/Shared/_Layout.cshtml";

    var templates = (List<MailTemplate>)ViewBag.MailTemplates;
}
<script src="@Url.Content("~/Scripts/jquery.validate.min.js")" type="text/javascript"></script>
<script src="@Url.Content("~/Scripts/jquery.validate.unobtrusive.min.js")" type="text/javascript"></script>
@section Includes
{
    <script type="text/javascript" src="/Scripts/MicrosoftAjax.js"></script>
    <script type="text/javascript" src="/Scripts/MicrosoftMvcValidation.js"></script>
    <script type="text/javascript" src="/Controls/ckeditor/ckeditor.js"></script>
    <script type="text/javascript" src="/Controls/ckeditor/adapters/jquery.js"></script>
    <script type="text/javascript">

        $(function () {
            $("#selectallagent").click(function () {
                if (this.checked) {
                    $(".agent").attr("checked", "checked");
                } else {
                    $(".agent").removeAttr("checked");
                }
            });

            $("#selectalltourist").click(function () {
                if (this.checked) {
                    $(".tourist").attr("checked", "checked");
                } else {
                    $(".tourist").removeAttr("checked");
                }

            });
        });
    </script>
}
@Html.Partial("SubscribeForm2", new Customers())
<br />
@using (Html.BeginForm("SendEmail", "Subscribe"))
{
    if ((int)ViewBag.SentEmails > 0)
    {
    <script type="text/javascript">
        alert("Сообщение отправлено");
    </script>
@*<div class="sentSubscribenotificationMessage">
            Сообщение отправлено
        </div>*@
    }

    <table class="subscriberList">
        <tr>
            <th colspan="3">
                Шаблоны рассылки
            </th>
        </tr>
        @foreach (var template in templates)
        {
            <tr>
                <td style="padding-right: 10px">
                    @Html.ActionLink(template.Title, "Subscribers", "Subscribe", new { templateId = template.Id }, null)
                </td>
                <td>
                    @Html.ActionLink("[редактировать]", "Edit", "MailTemplate", new { Area = "Admin", id = template.Id }, new { @class = "adminLink" })
                </td>
                <td>
                    @Html.ActionLink("[удалить]", "Delete", "MailTemplate", new { Area = "Admin", id = template.Id }, new { @class = "adminLink", onclick = "return confirm('Удалить шаблон?')" })
                </td>
            </tr>
        }
        <tr>
            <td colspan="3">
                @Html.ActionLink("Добавить шаблон", "Add", "MailTemplate", new { Area = "Admin" }, new { @class = "adminLink" })
            </td>
        </tr>
    </table>
    
    <div class="sendEmailContainer">
        
        
        <div style="text-align: left">
            Тема письма: @Html.TextBox("mailSubject", "", new { style = "width:500px" })<br />
            <br />
            @Html.TextArea("MailText", new { @class = "ckeditor" })
        </div>
        <br />
        <input type="submit" value="Отправить" />
    </div>
    <br />
    <br />
   <text>*отметьте e-mail адреса для отправки сообщения</text>
    <table class="subscriberListContainer">
        <tr>
            <td>
                <table class="subscriberList">
                    <tr>
                        <th>
                        </th>
                        <th>
                        </th>
                        <th>
                            Имя
                        </th>
                        <th>
                            email
                        </th>
                        <th>
                            news
                        </th>
                        <th>
                            удалить
                        </th>
                    </tr>
                    <tr>
                         <th  style="background-color: bisque">
                        </th>
                        <th class="checkbox" style="background-color: bisque">@Html.CheckBox("selectallagent")
                        </th>
                        <th colspan="4" style="background-color: bisque">
                            Агенты
                        </th>
                    </tr>
                    @{
                                                                         int cnt = 0;

                                                                         foreach (var subscriber in Model.Customers.Where(c => c.SubscribeType == 1).OrderBy(c => c.Name))
                                                                         {
                                                                             cnt++;
                            
                            <tr>
                                <td>@cnt</td>
                                <td class="checkbox_agent">
                                    @Html.CheckBox("agent_" + subscriber.Id, false, new { @class = "agent" })
                                </td>
                                <td>@subscriber.Name
                                </td>
                                <td>@subscriber.Email
                                </td>
                                <td>@Html.Raw(subscriber.IsActive == 0 ? "N" : "Y")
                                </td>
                                <td>@Html.ActionLink("ред.", "EditSubscriber", "Subscribe", new { id = subscriber.Id }, new { @class = "adminLink" })
                                    @Html.ActionLink("уд.", "DeleteSubscriber", "Subscribe", new { id = subscriber.Id }, new { @class = "adminLink", onclick = "return confirm('Удалить запись?')" })
                                </td>
                            </tr>
                                                                         }
                    }
                </table>
            </td>
            <td>
                <table class="subscriberList">
                    <tr>
                        <th>
                        </th>
                        <th>
                        </th>
                        <th>
                            Имя
                        </th>
                        <th>
                            email
                        </th>
                        <th>
                            news
                        </th>
                        <th>
                            удалить
                        </th>
                    </tr>
                    <tr>
                        <th style="background-color: bisque"></th>
                        <th class="checkbox" style="background-color: bisque">@Html.CheckBox("selectalltourist")
                        </th>
                        <th colspan="4" style="background-color: bisque">
                            Туристы
                        </th>
                    </tr>
                    @{
                                                                         cnt = 0;
                                                                         foreach (var subscriber in Model.Customers.Where(c => c.SubscribeType == 2).OrderBy(c => c.Name))
                                                                         {
                                                                             cnt++;
                            <tr>
                                <td>@cnt</td>
                                <td class="checkbox_tourist">
                                    @Html.CheckBox("tourist_" + subscriber.Id, false, new { @class = "tourist" })
                                </td>
                                <td>@subscriber.Name
                                </td>
                                <td>@subscriber.Email
                                </td>
                                <td>@Html.Raw(subscriber.IsActive == 0 ? "N" : "Y")
                                </td>
                                <td>@Html.ActionLink("ред.", "EditSubscriber", "Subscribe", new { id = subscriber.Id }, new { @class = "adminLink" })
                                    @Html.ActionLink("уд.", "DeleteSubscriber", "Subscribe", new { id = subscriber.Id }, new { @class = "adminLink", onclick = "return confirm('Удалить запись?')" })
                                </td>
                            </tr>
                                                                         }
                    }
                </table>
            </td>
        </tr>
    </table>
    <div style="text-align: center">
        <input type="submit" name="faSaveDefaultSubscribers" value="Сохранить отмеченные адреса для рассылки новостей"
            onclick="return confirm('Вы действительно хотите внести изменения в список адресов для рассылки новостей?')" />
    </div>
   
    
    
    
   
}
@section ContentTitle
{
    <div id="contentTitleSubscribe">
        Список подписчиков на новостную рассылку
    </div>
}
@section MainBanner
{
    <div id="slideshow">
        @foreach (var banner in Model.MainBanners)
        {
            @Html.Raw(Html.CachedImage("~/Content/Banners/", banner.ImageSource, "mainBanner", banner.Title, banner.Price, banner.ContentName))
        }
    </div>
}
@section SmallBannerLeft
{
    @if (Model.LeftBanner != null)
    {
        @Html.Partial("BannerSmall", Model.LeftBanner)
    }
}
@section SmallBannerRight
{
    @if (Model.RightBanner != null)
    {
        @Html.Partial("BannerSmall", Model.RightBanner)
    }
}
@section RootLogoLink
{
    @if (!Model.IsRoot)
    {
        <a href="/" class="rootLink">
            <img src="../../Content/img/pixel.gif" /></a>
    }
}
@section QuickSearch
{
    @if (!Model.IsRoot)
    {
        @Html.Partial("QuickSearch")
    }
}
@section MainMenu
{
    @{
        var menu = Model.MenuList.Where(m => m.MenuLevel == 1).Select(m => m).FirstOrDefault();
        @Html.Partial("MainMenu", menu)
    }
}
@section HeaderLeftMenu
{
    @Html.Partial("HeaderLeftMenu", Model.HeaderLeftMenuItems)
}
